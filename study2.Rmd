# Study 2: Comparing a Novice and an Expert Teacher (University Course)


In this case study, we aimed to explore the following research questions: _is it feasible to use a mobile eye-tracker to follow a teacher's cognitive load in an authentic classroom setting? Can we detect specific classroom interaction episodes that imply high (or low) cognitive load? Can we see differences between the orchestration load patterns of a novice and an expert teacher?_.

The **context** of the data gathering were three sessions of 45-65 minutes each, in a classroom with around 12-14 Master-level students, who were working with their laptops on a course about learning analytics (mostly, individual and pair work with occasional explanations by the teacher). There were two different teachers (an expert one in two sessions, and a novice one in the other), wearing a mobile eye-tracker while he facilitated the session.

## Before starting: Data download and pre-process

First of all, we download the datasets for the study, which has been published in Zenodo: 

* [Dataset for Study 2 (laptop classroom, master-level course, novice \& expert teacher)](https://zenodo.org/record/16514)

```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(ggplot2)
# We load the useful scripts and packages needed throughout the report
source("./lib/rollingWindows.R")
source("./lib/loadIndex.R")
source("./lib/extremeLoadExtraction.R")
source("./lib/aggregateEpisodeData.R")
source("./lib/multiplot.R")
source("./lib/outliers.R")

rootdir <- getwd()

# If not present already, download dataset study 2 and uncompress it to Study2/
setwd(paste(rootdir,"/data/study2",sep=""))
if(!file.exists("DELANA-VideoCodingData.zip") || !file.exists("DELANA-EyetrackingData.zip")){
    download.file("https://zenodo.org/record/16514/files/DELANA-VideoCodingData.zip", destfile="DELANA-VideoCodingData.zip", method="curl")
    unzip("DELANA-VideoCodingData.zip")
    download.file("https://zenodo.org/record/16514/files/DELANA-EyetrackingData.zip", destfile="DELANA-EyetrackingData.zip", method="curl")
    unzip("DELANA-EyetrackingData.zip")
} 

# Now we have the raw data files uncompressed in the data/study2 folder
```

Once we have the raw data from the eye-tracker (plus the video coding data generated by researchers), we pre-process it, mostly by aggregating the four load-related eyetracking metrics (pupil diameter mean, pupil diameter variation, saccade speed and number of fixations >500ms) into 10-second episodes, using a rolling window with 5-second slide between windows (see ```./lib/aggregateEpisodeData.R``` and ```./lib/rollingWindows.R``` files for details).

```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
setwd(paste(rootdir,"/data/study2",sep=""))

# We do the preprocessing, which will generate a Rda file with the 10s
# window data, and will return the name of the file

sessions <-  c("DELANA-Session1-Expert-eyetracking","DELANA-Session2-Expert-eyetracking","DELANA-Session3-Novice-eyetracking")

cleandatafile <- "study2ProcessedData.Rda"
if(!file.exists(cleandatafile)){
    data <- aggregateEpisodeData(sessions, datadir=paste(rootdir,"/data/study2",sep=""), initendtimes=NULL, SEPARATOR=";") # For this study the raw data is semicolon-separated, for the fix/sac at least!
    data <- data[,c(1:5,12)] # We select only the load-related metrics
    # We load and add the video coding data with the social, activity and main gaze focus dimensions
    videocodes <- read.csv("DELANA-videocoding.csv", sep=",")
    videocodes$session <- videocodes$Session
    totaldata <- merge(data,videocodes,by=c("session","time"),all=T)
    save(totaldata, file=cleandatafile)
}

```

### A: From samples to episodes

We first calculate the _coarse load index_ (how many measures are over the median) and the _fine load index_ (average of percentiles of the different load metrics), and we plot them for each session

```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.height=3, fig.width=8}
setwd(paste(rootdir,"/data/study2",sep=""))
totaldata <- get(load(cleandatafile))

# We crop outliers in the saccade speed. They tend to throw off the HMM and PCA calculations
#countOutliers(totaldata$value.Sac,coef = 20, method="iqr") # IQR is quite small (0.06), but there are quite a few samples outside this range, we make it 20xIQR
totaldata$value.Sac <- replaceOutliers(totaldata$value.Sac,valueNA = F,coef = 20, method="iqr")

loaddata <- calculateCoarseFineLoadIndex(totaldata,3:6,normalize=T) # We ensure that the values are normalized for those of the first window in which little load is assumed (just putting the eyetracker on)

# Check that all load metrics are directly proportional. If not, we need to introduce a modification in the calculations of load

# We plot the loads for each session, along with some smoothing
for(session in sessions){
    sessiondata <- loaddata[loaddata$session==session,]
    p1 <- ggplot(sessiondata, aes(x=time, y=CoarseLoad, col=CoarseLoad)) + 
            ggtitle(paste("Coarse Load Index ",session,sep="")) + 
            geom_line(size=1) + stat_smooth(method="loess",span=0.1,se=F) +
            #theme(axis.text.x = element_text(size=18),plot.title=element_text(size=20, face="bold"),axis.title=element_text(size=18),panel.background = element_rect(fill = 'white')) +
            theme(panel.background = element_rect(fill = 'white')) +
            scale_color_gradient(low="green",high="red")
    print(p1)

    p2 <- ggplot(sessiondata, aes(x=time, y=FineLoad, col=FineLoad)) + 
            ggtitle(paste("Fine Load Index ",session,sep="")) + 
            geom_line(size=1) + stat_smooth(method="loess",span=0.1,se=F) +
            #theme(axis.text.x = element_text(size=18),plot.title=element_text(size=20, face="bold"),axis.title=element_text(size=18),panel.background = element_rect(fill = 'white')) +
            theme(panel.background = element_rect(fill = 'white')) +
            scale_color_gradient(low="green",high="red")
    print(p2)
}
```

### B: Exploring the structure of the sensor (episode) load data 

First we do a Principal Component analysis to see what dimensions are there within these 4 load-related signals:

```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.height=5, fig.width=5}

library(FactoMineR)

# Overall for the three sessions
res.pca = PCA(loaddata[, c(3:6)], scale.unit=TRUE, ncp=5, graph=F)
plot.PCA(res.pca, axes=c(1, 2), choix="var", title="Overall data")
loaddata$PupilLoadDim = res.pca$ind$coord[,1]
loaddata$EyeMoveFixLoadDim = res.pca$ind$coord[,2]

# We now do it per session, to see if the two teachers are very different, and whether the expert is consistent in the dimensions... we find out that teachers differ a lot, and even sessions can be quite different
# for(session in sessions){
#     sessiondata <- loaddata[loaddata$session==session,]
#     res.pca = PCA(sessiondata[, c(3:6)], scale.unit=TRUE, ncp=5, graph=F)
#     print(plot.PCA(res.pca, axes=c(1, 2), choix="var",title = paste("Session",session)))
# }

# Since it looks like different people really have different patterns, we will analyze the structure of the load signals per-teacher
# Expert teacher
expertdata <- loaddata[loaddata$session==sessions[1] | loaddata$session==sessions[2],]
res.pca = PCA(expertdata[, c(3:6)], scale.unit=TRUE, ncp=5, graph=F)
print(plot.PCA(res.pca, axes=c(1, 2), choix="var",title = "Expert teacher"))
expertdata$PupilLoadDim = res.pca$ind$coord[,1]
expertdata$EyeMoveFixLoadDim = res.pca$ind$coord[,2]

# Novice teacher
novicedata <- loaddata[loaddata$session==sessions[3],]
res.pca = PCA(novicedata[, c(3:6)], scale.unit=TRUE, ncp=5, graph=F)
print(plot.PCA(res.pca, axes=c(1, 2), choix="var",title = "Novice teacher"))
novicedata$PupilLoadDim = res.pca$ind$coord[,2] # In this case, the pupil measure is in the second dimension, not the first
novicedata$EyeMoveFixLoadDim = res.pca$ind$coord[,1]

```

Interestingly, we can see that the two main dimensions of the load metric variability follows a similar pattern to that of study 1: there is a main dimension explained mainly by the pupil diameter measures (and a bit of the saccadic measurement), while the second dimension opposes the saccadic and fixation measures of load (again, maybe indicating two different ways in which a teacher can be "loaded").

However, looking at the two teachers separately, we see that the dimensions of variability are quite different from one to the other. There is always a dimension that opposes fixation- and saccade-based measures, and the other one tends to be lead by pupil diameter mean, but not so clearly. This may also be related to the classroom disposition, which was somehow opposed to that of study one (in this case, students and tables were in the center of the room, not along the walls)

To explore the temporal structure of these load-related sensor signals, we train a Hidden Markov Model for each teacher, with 4 states using the load-related signals as observables:

```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.height=5, fig.width=5}
library(depmixS4)

# We remove the missing data, as the HMM library does not like them, apparently
# Not needed, we have no missing data in that sense
#data4hmm <- loaddata[complete.cases(loaddata[,c("value.Mean","value.SD","value.Sac","value.Fix")]),]

numstates <- 4

# Overall -- not meaningful since we see some states are only applicable to some teachers and not others
# set.seed(1)
# #set up the HMM model
# mod <- depmix(list(value.Mean~1,value.SD~1,value.Sac~1,value.Fix~1), data=loaddata, nstates=numstates, family=list(gaussian(),gaussian(),gaussian(),poisson()),ntimes=summary(as.factor(loaddata$session)), verbose=F)
# #fit the model 
# f <- fit(mod, verbose=F)
# #check to see how the state transtion matricies and process mean/sd matches our sample data
# summary(f)
# #get the estimated state for each timestep 
# esttrans <- posterior(f)
# loaddata$MMstate <- esttrans[,1]
# #plot(1:nrow(loaddata), esttrans[,1], type='p', col=as.factor(loaddata$session), main=paste('Estimated state',numstates))
# 
# loaddata$MMstate <- factor(loaddata$MMstate)
# xtabs(~CoarseLoad+MMstate,data=loaddata)
# g1 <- ggplot(data = loaddata, mapping = aes(MMstate, FineLoad))+geom_boxplot(aes(fill=MMstate))+geom_jitter()
# print(g1)
# 
# # We can also plot the states with regard to the two load dimensions from the PCA
# g2 <- ggplot(data = loaddata, mapping = aes(PupilLoadDim,EyeMoveFixLoadDim)) + geom_point(aes(col=MMstate)) + xlim(-4,4) + ylim(-5,5)
# print(g2)
# 
# #State 1/2 seems to be mid/hi load, state 3 is mid load, state 4 is low-load
# levels(loaddata$MMstate) <- c("HiFixLoadState","HiSacLoadState","MidLoadState","LowLoadState")

# Expert teacher

# For some reason, this breaks!
# We plot the BIC for different number of states, just to check
hmmdata <- expertdata[complete.cases(expertdata[,c("value.Mean","value.SD","value.Sac","value.Fix")]),]
states <- 2:16
BICs <- 0
for(i in states){
#    print(paste(numstates,"..."))
    # Overall
    set.seed(23)
    #set up the HMM model
    mod <- depmix(list(value.Mean~1,value.SD~1,value.Sac~1,value.Fix~1), data=hmmdata, nstates=i, family=list(gaussian(),gaussian(),gaussian(),poisson()),ntimes=summary(as.factor(hmmdata$session)), verbose=F)
    #fit the model 
    f <- fit(mod, verbose=F)
#    print(f)
    BICs[i] <- BIC(f)
}
qplot(1:16,BICs,geom="line")



set.seed(1)
#set up the HMM model
mod <- depmix(list(value.Mean~1,value.SD~1,value.Sac~1,value.Fix~1), data=expertdata, nstates=numstates, family=list(gaussian(),gaussian(),gaussian(),poisson()),ntimes=summary(as.factor(expertdata$session)), verbose=F)
#fit the model 
f <- fit(mod, verbose=F)
#check to see how the state transtion matricies and process mean/sd matches our sample data
summary(f)
#get the estimated state for each timestep 
esttrans <- posterior(f)
expertdata$MMstate <- esttrans[,1]
#plot(1:nrow(expertdata), esttrans[,1], type='p', col=as.factor(expertdata$session), main=paste('Estimated state',numstates))

expertdata$MMstate <- factor(expertdata$MMstate)
xtabs(~CoarseLoad+MMstate,data=expertdata)
g1 <- ggplot(data = expertdata, mapping = aes(MMstate, FineLoad))+geom_boxplot(aes(fill=MMstate))+geom_jitter(aes(col=session))
print(g1)

# We can also plot the states with regard to the two load dimensions from the PCA
g2 <- ggplot(data = expertdata, mapping = aes(PupilLoadDim,EyeMoveFixLoadDim)) + geom_point(aes(col=MMstate))# + xlim(-4,4) + ylim(-5,5)
print(g2)

#State 1/2 seems to be mid/hi load, state 3 is mid load, state 4 is low-load
levels(expertdata$MMstate) <- c("HiFixLoadState","MidLoadState","HiSacLoadState","LowLoadHiFixState")



```

As we can see, for the **expert teacher**, State 2 seems to be the medium load one, for both sessions. State 1 seems to be a higher-load state (from session 2), while State 3 is a different kind of higher-load state for both sessions. Finally, State 4 is a lower-load state (mostly from session 1). 

Also, looking at the two dimensions of load from the PCA we see how these states separate quite clearly the load values:

* State 1: high-load state regarding pupil diameter, more fixation-based load
* State 2: medium load in both dimensions
* State 3: high-load state regarding pupil diameter, more saccade-based load
* State 4: low load regarding pupil diameter, but somewhat slanted towards more fixation-based load


```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE, fig.height=5, fig.width=5}

# Novice teacher

# We plot the BIC for different number of states, just to check
states <- 2:16
BICs <- 0
for(i in states){
#    print(paste(numstates,"..."))
    # Overall
    set.seed(1)
    #set up the HMM model
    mod <- depmix(list(value.Mean~1,value.SD~1,value.Sac~1,value.Fix~1), data=novicedata, nstates=i, family=list(gaussian(),gaussian(),gaussian(),poisson()),ntimes=summary(as.factor(novicedata$session)), verbose=F)
    #fit the model 
    f <- fit(mod, verbose=F)
#    print(f)
    BICs[i] <- BIC(f)
}
qplot(1:16,BICs,geom="line")



set.seed(1)
#set up the HMM model
mod <- depmix(list(value.Mean~1,value.SD~1,value.Sac~1,value.Fix~1), data=novicedata, nstates=numstates, family=list(gaussian(),gaussian(),gaussian(),poisson()),ntimes=summary(as.factor(novicedata$session)), verbose=F)
#fit the model 
f <- fit(mod, verbose=F)
#check to see how the state transtion matricies and process mean/sd matches our sample data
summary(f)
#get the estimated state for each timestep 
esttrans <- posterior(f)
novicedata$MMstate <- esttrans[,1]
#plot(1:nrow(novicedata), esttrans[,1], type='p', col=as.factor(novicedata$session), main=paste('Estimated state',numstates))

novicedata$MMstate <- factor(novicedata$MMstate)
xtabs(~CoarseLoad+MMstate,data=novicedata)
g1 <- ggplot(data = novicedata, mapping = aes(MMstate, FineLoad))+geom_boxplot(aes(fill=MMstate))+geom_jitter(aes(col=session))
print(g1)

# We can also plot the states with regard to the two load dimensions from the PCA
g2 <- ggplot(data = novicedata, mapping = aes(PupilLoadDim,EyeMoveFixLoadDim)) + geom_point(aes(col=MMstate))# + xlim(-4,4) + ylim(-5,5)
print(g2)

#State 1/2 seems to be mid/hi load, state 3 is mid load, state 4 is low-load
levels(novicedata$MMstate) <- c("HiFixLoadState","MidSacLoadState","LowLoadState","MidFixLoadState")



```

As we can see, for the **novice teacher**, State 3 seems to be a low-load one. State 1 seems to be a higher-load state, while State 4 is a different kind of mid-higher-load state. Finally, State 2 is a mid-load state. 

Also, looking at the two dimensions of load from the PCA we see how these states separate better the load values, even if not very neatly:

* State 1: Varies wildly in pupil diameter load, but has more fixation-based load
* State 2: Medium-load state, more oriented towards pupil diameter load and saccadic load
* State 3: Low-load state
* State 4: Medium-high load state, especially from the point of view of fixation load

These states are not so clear as in the other cases, probably because the amount of data is relatively small, to see clear trends.

### C: Subjective episode analysis

Unfortunately, we lost this part of the dataset for technical reasons, and thus cannot be analyzed :(

### D: Behavioral episode analysis

From the coarse load index, we extracted the extreme load episodes (10-second episodes with a coarse load index of 0 or 4), for manual coding of the subjective video feed by a researcher (see the ```./lib/extremeLoadExtraction.R``` file).

```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
outputfile <- paste(rootdir,"/data/study2/TimesToVideoCode.csv",sep="")
extremedata <- extractExtremeLoadMoments(sessions, loaddata, outputfile)
```

We manually coded the videos of all these extreme load episodes, along the dimensions of teacher activity, social plane of the interaction and main focus of gaze (see the ```DELANA-videocoding.csv``` datafile). We then aggregate the code counts for each of these dimensions, to bridge from the episode-level analysis to have an idea of what kind of episodes are often high or low (coarse/fine) load. Also, comparisons with fine load, and the PCA and HMM dimensions of load data are made.

```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Overall behavioral analyses
# ACTIVITY
# Additional non-extreme episodes were also coded, we eliminate them to get the coarse load contrast
behdata <- loaddata[(loaddata$CoarseLoad==4|loaddata$CoarseLoad==0)&(!is.na(loaddata$Activity)),]
behdata$Activity <- factor(behdata$Activity)
# chi-squared test and counts/residuals table for teacher activity
tabAct <- table(behdata$CoarseLoad,behdata$Activity)
chisq.test(tabAct)
tabAct
chisq.test(tabAct)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
#g1 <- ggplot(loaddata[!is.na(loaddata$Activity),],aes(Activity,FineLoad)) + geom_boxplot(aes(fill=Activity))
#print(g1)
# Density plots for the PCA dimensions for each kind of activity
g1 <- ggplot(loaddata[!is.na(loaddata$Activity),],aes(PupilLoadDim)) + geom_density(aes(col=Activity))
print(g1)
g2 <- ggplot(loaddata[!is.na(loaddata$Activity),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Activity))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(loaddata[, c(3:6, 12)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load -- This was not really done for overall data
# hmmActTab <- xtabs(~Activity+MMstate, data=loaddata[!is.na(loaddata$Activity),])
# chisq.test(hmmActTab)
# hmmActTab
# chisq.test(hmmActTab)$residuals

```

Looking at the overall data, we find that **Activity** could be independent of the coarse load, and we see how MONitoring and REPairs are higher-load (fixation-heavy) somehow, while TDT and QUESTioning are in the lower-load, saccade-heavy part of the spectrum. But this analysis is not as interesting as the per-teacher one.


```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Expert teacher analyses
# ACTIVITY
# Additional non-extreme episodes were also coded, we eliminate them to get the coarse load contrast
behdata <- expertdata[(expertdata$CoarseLoad==4|expertdata$CoarseLoad==0)&(!is.na(expertdata$Activity)),]
behdata$Activity <- factor(behdata$Activity)
# chi-squared test and counts/residuals table for teacher activity
tabAct <- table(behdata$CoarseLoad,behdata$Activity)
chisq.test(tabAct)
tabAct
chisq.test(tabAct)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
#g1 <- ggplot(expertdata[!is.na(expertdata$Activity),],aes(Activity,FineLoad)) + geom_boxplot(aes(fill=Activity))
#print(g1)
# Density plots for the PCA dimensions for each kind of activity
g1 <- ggplot(expertdata[!is.na(expertdata$Activity),],aes(PupilLoadDim)) + geom_density(aes(col=Activity))
print(g1)
g2 <- ggplot(expertdata[!is.na(expertdata$Activity),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Activity))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(expertdata[, c(3:6, 12)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load -- This was not really done for overall data
hmmActTab <- xtabs(~Activity+MMstate, data=expertdata[!is.na(expertdata$Activity),])
chisq.test(hmmActTab)
hmmActTab
chisq.test(hmmActTab)$residuals

```

The **Activity** distribution is likely to be independent of the coarse load. Also, we see that the differences in the load dimensions with regard to Activities is not very distinct

The two dimensions serve to see again how TDT seems to be low-load with more emphasis on the saccade metric, but in general separation between activities in not very clear. The HMM states modelling of load separates certain activities from one another, and help us see these trends in another light, so we see that TDT is in the "low load but high fixation", REPairs are more common in "high load saccadic" state, EXPlanations seem to be more in the "mid-load state", while MONitoring is more on the "high load fixation state".

Thus we see that, maybe, _the activities being done are not affecting very clearly the expert teacher_.


```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Novice teacher analyses
# ACTIVITY
# Additional non-extreme episodes were also coded, we eliminate them to get the coarse load contrast
behdata <- novicedata[(novicedata$CoarseLoad==4|novicedata$CoarseLoad==0)&(!is.na(novicedata$Activity)),]
behdata$Activity <- factor(behdata$Activity)
# chi-squared test and counts/residuals table for teacher activity
tabAct <- table(behdata$CoarseLoad,behdata$Activity)
chisq.test(tabAct)
tabAct
chisq.test(tabAct)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
#g1 <- ggplot(novicedata[!is.na(novicedata$Activity),],aes(Activity,FineLoad)) + geom_boxplot(aes(fill=Activity))
#print(g1)
# Density plots for the PCA dimensions for each kind of activity
g1 <- ggplot(novicedata[!is.na(novicedata$Activity),],aes(PupilLoadDim)) + geom_density(aes(col=Activity))
print(g1)
g2 <- ggplot(novicedata[!is.na(novicedata$Activity),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Activity))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(novicedata[, c(3:6, 12)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load -- This was not really done for overall data
hmmActTab <- xtabs(~Activity+MMstate, data=novicedata[!is.na(novicedata$Activity),])
chisq.test(hmmActTab)
hmmActTab
chisq.test(hmmActTab)$residuals

```

In the case of the **novice** teacher, we how even with less data points, the distribution of load seems to be related to the different teacher activities: EXPlanations seem to be higher-load, while REPairs seem to be lower load in general (TDT and QUEST are too infrequent to really say anything). These differences in load are mostly visible in the pupil diameter dimension, but also in the saccade/fixation one. 

In this case the HMM states modelling of load separates certain activities from one another: EXPlanations are in the "high-load high fixation" and "medium-load high fixation" states, MONitoring tends to be in the "medium load high saccade" state, and REPairs are more in the "low-load state"

Thus we see how the _activities being done are affecting more clearly the novice teacher_, in a similar direction to that of the (also novice) teacher in study 1.



```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# SOCIAL
# Overall analysis
behdata <- loaddata[(loaddata$CoarseLoad==4|loaddata$CoarseLoad==0)&(!is.na(loaddata$Social)),]
behdata$Social <- factor(behdata$Social)
# chi-squared test and counts/residuals table for social plane of interaction
tabSoc <- table(behdata$CoarseLoad,behdata$Social)
chisq.test(tabSoc)
tabSoc
chisq.test(tabSoc)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
g1 <- ggplot(loaddata[!is.na(loaddata$Social),],aes(Social,FineLoad)) + geom_boxplot(aes(fill=Social))
print(g1)
# Density plots for the PCA dimensions for each kind of activity
g1 <- ggplot(loaddata[!is.na(loaddata$Social),],aes(PupilLoadDim)) + geom_density(aes(col=Social))
print(g1)
g2 <- ggplot(loaddata[!is.na(loaddata$Social),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Social))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(loaddata[, c(3:6, 13)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load
#hmmSocTab <- xtabs(~Social+MMstate, data=loaddata[!is.na(loaddata$Social),])
#chisq.test(hmmSocTab)
#hmmSocTab
#chisq.test(hmmSocTab)$residuals

```

Analyzing the overall data, the distribution with respect to **Social plane** is statistically significant, and the high-load episodes tend to be more often in the classroom plane, while the low-load tend to be in the individual/group plane. However, looking at the two load dimensions, it seems like the INDividual and CLSsroom levels are very close together (GRP is very infrequent). Probably we need to analyze the data on a teacher level to see clear trends...


```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Expert teacher analysis
expertdata$Social <- factor(expertdata$Social) # To eliminate nonexistent levels

behdata <- expertdata[(expertdata$CoarseLoad==4|expertdata$CoarseLoad==0)&(!is.na(expertdata$Social)),]
behdata$Social <- factor(behdata$Social)
# chi-squared test and counts/residuals table for social plane of interaction
tabSoc <- table(behdata$CoarseLoad,behdata$Social)
chisq.test(tabSoc)
tabSoc
chisq.test(tabSoc)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
g1 <- ggplot(expertdata[!is.na(expertdata$Social),],aes(Social,FineLoad)) + geom_boxplot(aes(fill=Social))
print(g1)
# Density plots for the PCA dimensions for each kind of activity
g1 <- ggplot(expertdata[!is.na(expertdata$Social),],aes(PupilLoadDim)) + geom_density(aes(col=Social))
print(g1)
g2 <- ggplot(expertdata[!is.na(expertdata$Social),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Social))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(expertdata[, c(3:6, 13)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load
hmmSocTab <- xtabs(~Social+MMstate, data=expertdata[!is.na(expertdata$Social),])
chisq.test(hmmSocTab)
hmmSocTab
chisq.test(hmmSocTab)$residuals

```

In the case of the **expert** teacher, there is a certain trend of **Social** plane being more class-level in the high-load episodes, but it is not statistically significant. This trend can be seen more clearly in the pupil-diameter dimension of the load metrics.

Even though these trends are not clear, the HMM load states seem to be related to the social level: CLS seem to be most prominently in the "mid load state", while INDividual is more common in the "low load high fixation" state (but still the individual level episodes are too few to ascertain clearly these trends)



```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Novice teacher analysis
novicedata$Social <- factor(novicedata$Social) # To eliminate nonexistent levels

behdata <- novicedata[(novicedata$CoarseLoad==4|novicedata$CoarseLoad==0)&(!is.na(novicedata$Social)),]
behdata$Social <- factor(behdata$Social)
# chi-squared test and counts/residuals table for social plane of interaction
tabSoc <- table(behdata$CoarseLoad,behdata$Social)
chisq.test(tabSoc)
tabSoc
chisq.test(tabSoc)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
g1 <- ggplot(novicedata[!is.na(novicedata$Social),],aes(Social,FineLoad)) + geom_boxplot(aes(fill=Social))
print(g1)
# Density plots for the PCA dimensions for each kind of activity
g1 <- ggplot(novicedata[!is.na(novicedata$Social),],aes(PupilLoadDim)) + geom_density(aes(col=Social))
print(g1)
g2 <- ggplot(novicedata[!is.na(novicedata$Social),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Social))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(novicedata[, c(3:6, 13)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load
hmmSocTab <- xtabs(~Social+MMstate, data=novicedata[!is.na(novicedata$Social),])
chisq.test(hmmSocTab)
hmmSocTab
chisq.test(hmmSocTab)$residuals

```

In the case of the **novice** teacher, there is a more clear trend of **Social** plane being more class-level in the high-load episodes, which in this case _is_ statistically significant. This trend can be seen more clearly in the pupil-diameter dimension of the load metrics, but also on the fixation/saccade one (classroom-level seem to be more fixation-heavy).

The HMM load states seem to be also related to the social level: CLS seem to be most prominently in the "high load fixation" and "mid-load high fixation" states, while INDividual is more common in the "low load" state (but still the individual level episodes are relatively few to make strong claims).



```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# FOCUS
# Overall data analysis
behdata <- loaddata[(loaddata$CoarseLoad==4|loaddata$CoarseLoad==0)&(!is.na(loaddata$Focus)),]
behdata$Focus <- factor(behdata$Focus)
# chi-squared test and counts/residuals table for main focus of gaze
tabFoc <- table(behdata$CoarseLoad,behdata$Focus)
chisq.test(tabFoc)
tabFoc
chisq.test(tabFoc)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
g1 <- ggplot(loaddata[!is.na(loaddata$Focus),],aes(Focus,FineLoad)) + geom_boxplot(aes(fill=Focus))
print(g1)
# Density plots for the PCA dimensions for each kind of activity ... not very readable
g1 <- ggplot(loaddata[!is.na(loaddata$Focus),],aes(PupilLoadDim)) + geom_density(aes(col=Focus))
print(g1)
g2 <- ggplot(loaddata[!is.na(loaddata$Focus),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Focus))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(loaddata[, c(3:6, 11)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load
# hmmFocTab <- xtabs(~Focus+MMstate, data=loaddata[!is.na(loaddata$Focus),])
# chisq.test(hmmFocTab)
# hmmFocTab
# chisq.test(hmmFocTab)$residuals
```

The overall analysis of **Gaze focus** shows that it is very unlikely to be independent of the cognitive load measures. The residuals tell us that high-load episodes are more often looking at the WHITeboard, or FACes of people. Low-load are majoritarily focusing on the teacher or student's SCOMPuter, as well as the PROJector.

The PCA dimensions, however, show how SCOMP is rather high in pupil-diameter and fixation dimensions of load, while most of the others score relatively low on pupil diameter dimension, leaning towards saccadic load.

These slightly contradictory results probably indicate that we should look also at a teacher-by-teacher basis to tear apart these trends more clearly.


```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Expert data analysis
behdata <- expertdata[(expertdata$CoarseLoad==4|expertdata$CoarseLoad==0)&(!is.na(expertdata$Focus)),]
behdata$Focus <- factor(behdata$Focus)
# chi-squared test and counts/residuals table for main focus of gaze
tabFoc <- table(behdata$CoarseLoad,behdata$Focus)
chisq.test(tabFoc)
tabFoc
chisq.test(tabFoc)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
g1 <- ggplot(expertdata[!is.na(expertdata$Focus),],aes(Focus,FineLoad)) + geom_boxplot(aes(fill=Focus))
print(g1)
# Density plots for the PCA dimensions for each kind of activity ... not very readable
g1 <- ggplot(expertdata[!is.na(expertdata$Focus),],aes(PupilLoadDim)) + geom_density(aes(col=Focus))
print(g1)
g2 <- ggplot(expertdata[!is.na(expertdata$Focus),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Focus))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(expertdata[, c(3:6, 11)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load
expertdata$Focus <- factor(expertdata$Focus) # We remove nonexistent focus levels
hmmFocTab <- xtabs(~Focus+MMstate, data=expertdata[!is.na(expertdata$Focus),])
chisq.test(hmmFocTab)
hmmFocTab
chisq.test(hmmFocTab)$residuals
```

For the sessions of the **expert teacher**, we can see that the main gaze focus seems significantly related to the cognitive load measures. High-load episodes seem to be rather looking at FACes and the WHITeboard, while low-load episodes seem to be more on the teacher's TCOMPuter or the PROJector.

The PCA dimensions do not seem to show such clear trends: from those gaze focuses of which we have enough cases, only TCOMP has substantially lower pupil-diameter-related load, and the differences in terms of fixation-saccade are less noticeable (WHIT being higher in the fixation-side and PROJ/TCOMP more on the saccade side).

The HMM load states seem to be clearly linked with the gaze focus, with TCOMP being more on the "low-load but high fixation" state, FAC, PROJ and WHIT being on the "mid-load" state.

Hence, we see that even if there is a certain trend of faces and the whiteboard being higher load, and TCOMP being lower load, but these trends are not so clear, with _a lot of episodes falling in the "mid-load"_.

```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Novice data analysis
behdata <- novicedata[(novicedata$CoarseLoad==4|novicedata$CoarseLoad==0)&(!is.na(novicedata$Focus)),]
behdata$Focus <- factor(behdata$Focus)
# chi-squared test and counts/residuals table for main focus of gaze
tabFoc <- table(behdata$CoarseLoad,behdata$Focus)
chisq.test(tabFoc)
tabFoc
chisq.test(tabFoc)$residuals

# Plotting against the FineLoad is not very revealing, as we took extreme values and the averages will always be around the average values!
g1 <- ggplot(novicedata[!is.na(novicedata$Focus),],aes(Focus,FineLoad)) + geom_boxplot(aes(fill=Focus))
print(g1)
# Density plots for the PCA dimensions for each kind of activity ... not very readable
g1 <- ggplot(novicedata[!is.na(novicedata$Focus),],aes(PupilLoadDim)) + geom_density(aes(col=Focus))
print(g1)
g2 <- ggplot(novicedata[!is.na(novicedata$Focus),],aes(EyeMoveFixLoadDim)) + geom_density(aes(col=Focus))
print(g2)
# Another way of seeing this, in the PCA diagram
res.pca = PCA(novicedata[, c(3:6, 11)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load
novicedata$Focus <- factor(novicedata$Focus) # We remove nonexistent focus levels
hmmFocTab <- xtabs(~Focus+MMstate, data=novicedata[!is.na(novicedata$Focus),])
chisq.test(hmmFocTab)
hmmFocTab
chisq.test(hmmFocTab)$residuals
```

Interestingly, in the case of the **novice teacher** we cannot exclude statistically that it is unrelated to load (maybe due to the lower amount of data available). There is a certain trend of FACes being high load and SCOMP and TCOMP being lower load. This trend is quite clear in the pupil-diameter dimension of load, but not so much in the fixation/saccades one.

The HMM load states seem to be clearly linked with the gaze focus, with FACes being in the "mid-load high fixation" state, SCOMP and TCOMP being more on "low-load" or "mid-load high-saccade" states.

Hence, we see that even if there is a certain trend of faces being higher load (common with the expert teacher), and TCOMP (also seen in the expert) and SCOMP being lower load, but still _a lot of episodes falling in the "mid-load"_.

### E: Session-level analysis and comparison

Since we had no subjective ratings (for the session or for individual episodes) for cognitive load, all we can do is compare the quantitative, sensor-based load values for each session, to get an idea of which session could have been more or less "loading"

```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Plotting the FineLoad of each session
g1 <- ggplot(loaddata,aes(session,FineLoad)) + geom_boxplot(aes(fill=session))
print(g1)
g1 <- ggplot(loaddata,aes(FineLoad)) + geom_density(aes(col=session))
print(g1)

# Plotting against the PCA and HMM dimensions
g1 <- ggplot(loaddata,aes(PupilLoadDim)) + geom_density(aes(col=session))
print(g1)
g1 <- ggplot(loaddata,aes(EyeMoveFixLoadDim)) + geom_density(aes(col=session))
print(g1)
loaddata$session <- factor(loaddata$session)
res.pca = PCA(loaddata[, c(3:6, 1)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load
#hmmSessTab <- xtabs(~session+MMstate, data=loaddata)
#chisq.test(hmmSessTab)
#hmmSessTab
#chisq.test(hmmSessTab)$residuals
```

We see that differences in general (fine) load were rather minimal, with maybe a slightly higher load in the expert's session 1. However, we do see differences between sessions in the pupil diameter and fixation/saccade PCA dimensions (higher for the novice teacher session).


```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# Expert session
# Plotting the FineLoad of each session
g1 <- ggplot(expertdata,aes(session,FineLoad)) + geom_boxplot(aes(fill=session))
print(g1)
g1 <- ggplot(expertdata,aes(FineLoad)) + geom_density(aes(col=session))
print(g1)

# Plotting against the PCA and HMM dimensions
g1 <- ggplot(expertdata,aes(PupilLoadDim)) + geom_density(aes(col=session))
print(g1)
g1 <- ggplot(expertdata,aes(EyeMoveFixLoadDim)) + geom_density(aes(col=session))
print(g1)
expertdata$session <- factor(expertdata$session)
res.pca = PCA(expertdata[, c(3:6, 1)], scale.unit=TRUE, ncp=5, graph=F, quali.sup=5)
#plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5)
plot.PCA(res.pca, axes=c(1, 2), choix="ind", habillage=5, invisible="ind")

# Comparison against the HMM states of load
#hmmSessTab <- xtabs(~session+MMstate, data=expertdata)
#chisq.test(hmmSessTab)
#hmmSessTab
#chisq.test(hmmSessTab)$residuals
```

However, comparing the **two sessions by the expert teacher**, we find that both sessions are rather similar with respect to fine load, and with respect to the fixation/saccade dimension. However, there is a quite noticeable difference in terms of the pupil diameter dimension, with session 2 being higher load.



```{r, cache=FALSE, message=FALSE, warning=FALSE, echo=FALSE}
# We come to the root folder, for the next study
setwd(rootdir)
```
